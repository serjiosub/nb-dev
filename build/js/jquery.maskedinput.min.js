!function(a){var v,e,t,k=(e=document.createElement("input"),t="onpaste",e.setAttribute(t,""),("function"==typeof e[t]?"paste":"input")+".mask"),n=navigator.userAgent,b=/iphone/i.test(n),y=/android/i.test(n);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,h){var n,d,m,p,g;return!t&&0<this.length?a(this[0]).data(a.mask.dataName)():(h=a.extend({placeholder:a.mask.placeholder,completed:null},h),n=a.mask.definitions,d=[],m=g=t.length,p=null,a.each(t.split(""),function(e,t){"?"==t?(g--,m=e):n[t]?(d.push(RegExp(n[t])),null===p&&(p=d.length-1)):d.push(null)}),this.trigger("unmask").each(function(){function i(e){for(;g>++e&&!d[e];);return e}function r(e,t){var n,a;if(!(e<0)){for(n=e,a=i(t);n<g;n++)if(d[n]){if(!(a<g&&d[n].test(u[a])))break;u[n]=u[a],u[a]=h.placeholder,a=i(a)}c(),s.caret(Math.max(p,e))}}function o(e,t){for(var n=e;n<t&&n<g;n++)d[n]&&(u[n]=h.placeholder)}function c(){s.val(u.join(""))}function l(e){var t,n=s.val(),a=-1,r=0;for(pos=0;r<g;r++)if(d[r]){for(u[r]=h.placeholder;pos++<n.length;)if(t=n.charAt(pos-1),d[r].test(t)){u[r]=t,a=r;break}if(pos>n.length)break}else u[r]===n.charAt(pos)&&r!==m&&(pos++,a=r);return e?c():a+1<m?(s.val(""),o(0,g)):(c(),s.val(s.val().substring(0,a+1))),m?r:p}var s=a(this),u=a.map(t.split(""),function(e){return"?"!=e?n[e]?h.placeholder:e:void 0}),f=s.val();s.data(a.mask.dataName,function(){return a.map(u,function(e,t){return d[t]&&e!=h.placeholder?e:null}).join("")}),s.attr("readonly")||s.one("unmask",function(){s.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){var e;clearTimeout(v),f=s.val(),e=l(),v=setTimeout(function(){c(),e==t.length?s.caret(0,e):s.caret(e)},10)}).bind("blur.mask",function(){l(),s.val()!=f&&s.change()}).bind("keydown.mask",function(e){var t,n,a=e.which;8===a||46===a||b&&127===a?(t=(n=s.caret()).begin,0==(n=n.end)-t&&(t=46!==a?function(e){for(;0<=--e&&!d[e];);return e}(t):n=i(t-1),n=46===a?i(n):n),o(t,n),r(t,n-1),e.preventDefault()):27==a&&(s.val(f),s.caret(0,l()),e.preventDefault())}).bind("keypress.mask",function(e){var t=e.which,n=s.caret();e.ctrlKey||e.altKey||e.metaKey||t<32||t&&(0!=n.end-n.begin&&(o(n.begin,n.end),r(n.begin,n.end-1)),(n=i(n.begin-1))<g&&(t=String.fromCharCode(t),d[n].test(t)&&(function(e){for(var t,n,a=e,r=h.placeholder;a<g;a++)if(d[a]){if(t=i(a),n=u[a],u[a]=r,!(t<g&&d[t].test(n)))break;r=n}}(n),u[n]=t,c(),n=i(n),y?setTimeout(a.proxy(a.fn.caret,s,n),0):s.caret(n),h.completed&&g<=n&&h.completed.call(s))),e.preventDefault())}).bind(k,function(){setTimeout(function(){var e=l(!0);s.caret(e),h.completed&&e==s.val().length&&h.completed.call(s)},0)}),l()}))}})}(jQuery);